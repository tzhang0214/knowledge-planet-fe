<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISP图像处理知识库</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            margin-left: 30%;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* ISP架构图移到顶部 */
        .flow-diagram {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 30px;
        }

        .flow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .flow-title {
            font-size: 1.6rem;
            color: #333;
            padding: 12px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 0;
        }

        .flow-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .version-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .version-selector label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .version-selector select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .version-selector select:hover {
            border-color: #4ecdc4;
        }

        .version-selector select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .compare-controls {
            position: relative;
        }

        .compare-btn {
            padding: 8px 16px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .compare-panel {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 250px;
            margin-top: 10px;
        }

        .compare-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1rem;
        }

        .compare-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .compare-options label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #555;
        }

        .compare-options input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .start-compare-btn, .cancel-compare-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .start-compare-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .cancel-compare-btn {
            background: #f0f0f0;
            color: #666;
        }

        .start-compare-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .cancel-compare-btn:hover {
            background: #e0e0e0;
        }

        .flow-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
            position: relative;
            min-height: 200px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .flow-main-pipeline {
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            flex: 1;
        }

        .flow-infrastructure {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            justify-content: flex-start;
            min-width: 200px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 15px;
            border: 2px dashed #ccc;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }

        .infrastructure-title {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            padding: 8px 15px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* 基础设施中的内存模块特殊样式 */
        .flow-infrastructure .flow-subgraph {
            border: 2px dashed #ffc107;
            background: rgba(255, 193, 7, 0.1);
            box-shadow: 0 2px 10px rgba(255, 193, 7, 0.2);
        }

        .flow-infrastructure .flow-subgraph:hover {
            border-color: #ff9800;
            background: rgba(255, 193, 7, 0.15);
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .flow-container.compare-mode {
            flex-direction: column;
            gap: 40px;
        }

        .compare-row {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            justify-content: center;
            flex-wrap: wrap;
        }

        .compare-version {
            border: 3px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.98);
            position: relative;
        }

        .compare-version-title {
            position: absolute;
            top: -15px;
            left: 20px;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            border: 2px solid #ddd;
        }

        .compare-version.flowData {
            border-color: #4ecdc4;
        }

        .compare-version.flowData1 {
            border-color: #ff6b6b;
        }

        .compare-version.flowData2 {
            border-color: #9c27b0;
        }

        .compare-version.flowData .compare-version-title {
            border-color: #4ecdc4;
            color: #4ecdc4;
        }

        .compare-version.flowData1 .compare-version-title {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .compare-version.flowData2 .compare-version-title {
            border-color: #9c27b0;
            color: #9c27b0;
        }

        .flow-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            position: relative;
        }

        .flow-step {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            min-width: 100px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .flow-step:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .flow-step h3 {
            font-size: 0.8rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .flow-step p {
            font-size: 0.6rem;
            opacity: 0.9;
            line-height: 1.1;
        }

        /* 不同域的颜色 */
        .flow-step.sensor {
            background: linear-gradient(135deg, #f9f, #e91e63);
        }

        .flow-step.raw {
            background: linear-gradient(135deg, #f96, #ff9800);
        }

        .flow-step.rgb {
            background: linear-gradient(135deg, #6f9, #4caf50);
        }

        .flow-step.yuv {
            background: linear-gradient(135deg, #69f, #2196f3);
        }

        .flow-step.output {
            background: linear-gradient(135deg, #9f9, #8bc34a);
        }

        .flow-step.memory {
            background: linear-gradient(135deg, #ff9, #ffc107);
            color: #333;
        }

        /* 流动箭头 */
        .flow-arrow {
            position: relative;
            width: 30px;
            height: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flow-arrow::before {
            content: '→';
            font-size: 1.2rem;
            color: #333;
            animation: flowMove 2s infinite;
        }

        .flow-arrow.vertical::before {
            content: '↓';
            animation: flowMoveVertical 2s infinite;
        }

        .flow-arrow.feedback::before {
            content: '↻';
            animation: flowRotate 2s infinite;
        }

        @keyframes flowMove {
            0% { transform: translateX(-3px); opacity: 0.3; }
            50% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(3px); opacity: 0.3; }
        }

        @keyframes flowMoveVertical {
            0% { transform: translateY(-3px); opacity: 0.3; }
            50% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(3px); opacity: 0.3; }
        }

        @keyframes flowRotate {
            0% { transform: rotate(0deg); opacity: 0.3; }
            50% { transform: rotate(180deg); opacity: 1; }
            100% { transform: rotate(360deg); opacity: 0.3; }
        }

        /* 子图分组 */
        .flow-subgraph {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 12px;
            margin: 8px;
            background: rgba(255, 255, 255, 0.1);
            min-width: 180px;
            flex-shrink: 0;
        }

        .flow-subgraph-title {
            text-align: center;
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        /* 内存交互线 */
        /* .memory-connection {
            position: absolute;
            width: 2px;
            background: linear-gradient(to bottom, #ff9, #ffc107);
            border-radius: 1px;
            animation: memoryPulse 2s infinite;
        }

        @keyframes memoryPulse {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        } */

        /* 反馈循环线 */
        /* .feedback-connection {
            position: absolute;
            width: 2px;
            background: linear-gradient(to right, #6f9, #4caf50);
            border-radius: 1px;
            animation: feedbackPulse 2s infinite;
        }

        @keyframes feedbackPulse {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        } */

        .knowledge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .knowledge-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* 精简标题样式 */
        .section-title {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            padding: 10px 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .knowledge-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .knowledge-item {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
        }

        /* 知识点状态样式 */
        .knowledge-item.completed {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .knowledge-item.pending {
            background: linear-gradient(135deg, #c1c7d3, #c5a4fa);
            color: white;
        }

        .knowledge-item.future {
            background: linear-gradient(135deg, #9e9e9e, #757575);
            color: white;
        }

        .knowledge-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .knowledge-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .knowledge-item:hover::before {
            left: 100%;
        }

        .knowledge-item h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .knowledge-item p {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* 状态标识 */
        .status-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }

        .status-badge.completed {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .status-badge.pending {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .status-badge.future {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .knowledge-grid {
                grid-template-columns: 1fr;
            }
            
            .knowledge-items {
                grid-template-columns: 1fr;
            }
            
            .flow-container {
                flex-direction: column;
            }
            
            .flow-step::after {
                content: '↓';
                right: 50%;
                top: auto;
                bottom: -25px;
                transform: translateX(50%);
            }
        }

        .highlight {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        /* 硬件模块详情弹窗样式 */
        .module-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .module-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .module-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.7);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .module-modal.show .module-modal-content {
            transform: scale(1);
        }

        .module-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .module-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin: 0;
        }

        .module-modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .module-modal-close:hover {
            background: #f0f0f0;
            color: #666;
        }

        .module-modal-section {
            margin-bottom: 25px;
        }

        .module-modal-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .module-modal-section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border-radius: 2px;
        }

        .module-modal-section-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #555;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4ecdc4;
        }

        .module-modal-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
            text-align: center;
        }

        .module-modal-more-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
            text-decoration: none;
            display: inline-block;
        }

        .module-modal-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        /* 弹窗滚动条样式 */
        .module-modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .module-modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .module-modal-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .module-modal-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* 添加抽屉菜单样式 */
        .drawer-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 350px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.2);
            z-index: 3000;
            padding: 20px;
            overflow-y: auto;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .drawer-menu.open {
            transform: translateX(0);
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .drawer-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
            margin: 0;
        }

        .drawer-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .drawer-close:hover {
            background: #f0f0f0;
            color: #666;
        }

        .drawer-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .drawer-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .drawer-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .drawer-item-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .drawer-item-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.5;
        }

        .drawer-more-link {
            font-size: 0.85rem;
            color: #4ecdc4;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .drawer-more-link:hover {
            color: #44a08d;
            text-decoration: underline;
        }

        /* 悬停弹窗样式 */
        .hover-popup {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            min-width: 250px;
            max-width: 300px;
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .hover-popup.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .popup-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
            margin: 0 0 10px 0;
        }

        .popup-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .popup-item {
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #eee;
        }

        .popup-item-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #444;
            margin-bottom: 5px;
        }

        .popup-item-description {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }

        /* 抽屉菜单滚动条样式 */
        .drawer-menu::-webkit-scrollbar {
            width: 6px;
        }

        .drawer-menu::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .drawer-menu::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .drawer-menu::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* 搜索框相关样式 */
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .header-title {
            transition: transform 0.4s ease;
            transform-origin: left center;
        }

        .header-title.shifted {
            transform: translateX(-80%);
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-icon {
            font-size: 1.8rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .search-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .search-box {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            opacity: 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 30px;
            display: flex;
            align-items: center;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .search-box.expanded {
            width: 500px;
            opacity: 1;
        }

        .search-input {
            flex: 1;
            border: none;
            padding: 12px 20px;
            background: transparent;
            font-size: 1rem;
            outline: none;
            color: #333;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-button {
            background: transparent;
            border: none;
            padding: 12px 15px;
            cursor: pointer;
            color: #666;
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .search-button:hover {
            color: #4ecdc4;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .search-box.expanded {
                width: 200px;
            }
            
            .header-title.shifted {
                transform: translateX(-20%);
            }
        }

        /* AI聊天机器人*/
        .chatbot-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .chatbot-toggle {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: none;
            outline: none;
            user-select: none;
        }

        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .chatbot-modal {
            position: fixed;
            bottom: 120px;
            right: 30px;
            width: 500px;
            height: 600px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            overflow: hidden;
            resize: both;
            min-width: 300px;
            min-height: 400px;
            max-width: 90vw;
            max-height: 90vh;
        }

        .chatbot-modal.show {
            opacity: 1;
            transform: translateY(0);
        }

        .chatbot-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            user-select: none;
        }

        .chatbot-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            outline: none;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-close:hover {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }

        .chatbot-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 85%;
            padding: 15px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 1rem;
        }

        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            align-self: flex-start;
            background: #f0f0f0;
            color: #333;
            border-bottom-left-radius: 5px;
        }

        .chatbot-input {
            display: flex;
            padding: 15px;
            background: #f8f8f8;
            border-top: 1px solid #eee;
        }

        .chatbot-input input {
            flex: 1;
            padding: 14px 18px;
            border: 1px solid #ddd;
            border-radius: 30px;
            outline: none;
            font-size: 1rem;
        }

        .chatbot-input button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            margin-left: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            font-size: 1rem;
            font-weight: bold;
        }

        .chatbot-input button:hover {
            transform: scale(1.05);
        }

        .chatbot-input button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* 滚动条样式 */
        .chatbot-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chatbot-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .chatbot-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .chatbot-messages::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        @media (max-width: 768px) {
            .chatbot-modal {
                width: calc(100% - 40px);
                height: 500px;
                right: 20px;
                bottom: 100px;
            }
            
            .chatbot-toggle {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
        }
        </style>
</head>

<body>
    <!-- AI Chatbot HTML -->
    <div class="chatbot-container">
        <button class="chatbot-toggle" id="chatbotToggle">🤖</button>
        <div class="chatbot-modal" id="chatbotModal">
            <div class="chatbot-header">
                <div class="chatbot-title">ISP知识助手</div>
                <button class="chatbot-close" id="chatbotClose">&times;</button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="message ai">
                    您好！我是您的ISP知识助手，可以回答关于图像信号处理的各种问题。请问有什么我可以帮您的吗？
                </div>
            </div>
            <div class="chatbot-input">
                <input type="text" id="chatbotInput" placeholder="请输入您的问题...">
                <button id="chatbotSend">发送</button>
            </div>
        </div>
    </div>

    <script>
        // 改进的聊天机器人功能
        document.addEventListener('DOMContentLoaded', function() {
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotModal = document.getElementById('chatbotModal');
            const chatbotClose = document.getElementById('chatbotClose');
            const chatbotInput = document.getElementById('chatbotInput');
            const chatbotSend = document.getElementById('chatbotSend');
            const chatbotMessages = document.getElementById('chatbotMessages');
            const chatbotHeader = document.querySelector('.chatbot-header');
            
            // 聊天机器人拖动相关变量
            let isDragging = false;
            let isResizing = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;
            let dragStartX, dragStartY;
            let modalStartWidth, modalStartHeight;
            
            // Toggle chatbot visibility
            chatbotToggle.addEventListener('click', function() {
                chatbotModal.classList.toggle('show');
                if (chatbotModal.classList.contains('show')) {
                    // 显示时重置位置
                    resetPosition();
                }
            });
            
            // Close chatbot
            chatbotClose.addEventListener('click', function() {
                chatbotModal.classList.remove('show');
            });
            
            // Send message function
            function sendMessage() {
                const message = chatbotInput.value.trim();
                if (message) {
                    // Add user message
                    addMessage(message, 'user');
                    chatbotInput.value = '';
                    
                    // Simulate AI thinking
                    setTimeout(() => {
                        const response = generateAIResponse(message);
                        addMessage(response, 'ai');
                    }, 1000);
                }
            }
            
            // Send message on button click
            chatbotSend.addEventListener('click', sendMessage);
            
            // Send message on Enter key
            chatbotInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Add message to chat
            function addMessage(text, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', sender);
                messageElement.textContent = text;
                chatbotMessages.appendChild(messageElement);
                
                // Scroll to bottom
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }
            
            // Generate AI response
            function generateAIResponse(userMessage) {
                const lowerMessage = userMessage.toLowerCase();
                
                // ISP相关关键词响应
                if (lowerMessage.includes('你好') || lowerMessage.includes('您好')) {
                    return "您好！我是ISP知识助手，可以回答关于图像信号处理的各种问题。请问有什么我可以帮您的吗？";
                } else if (lowerMessage.includes('isp') && (lowerMessage.includes('什么') || lowerMessage.includes('介绍'))) {
                    return "ISP是Image Signal Processor（图像信号处理器）的缩写，它是数字相机和手机摄像头中的关键组件，负责将传感器捕获的原始数据处理成高质量的图像。";
                } else if (lowerMessage.includes('去马赛克') || lowerMessage.includes('demosaic')) {
                    return "去马赛克是ISP处理流程中的关键步骤，用于从Bayer滤镜阵列的单色像素重建全彩色图像。它通过插值算法利用周围像素的色彩信息来估计缺失的色彩分量。";
                } else if (lowerMessage.includes('白平衡') || lowerMessage.includes('awb')) {
                    return "自动白平衡(AWB)用于调整图像的色温，使白色物体在不同光照条件下呈现真实的白色。它基于灰度世界假设或白点检测算法，计算RGB通道的增益系数来调整色彩平衡。";
                } else if (lowerMessage.includes('bayer') || lowerMessage.includes('拜耳')) {
                    return "Bayer滤镜是最常见的色彩滤镜阵列，按RGGB模式排列。它使每个像素只捕获一种颜色信息，然后通过去马赛克算法重建完整的RGB图像。";
                } else if (lowerMessage.includes('降噪') || lowerMessage.includes('噪声')) {
                    return "ISP中的降噪算法包括2D降噪(空间域)和3D降噪(时间域)。2D降噪处理单帧图像，3D降噪利用多帧信息，通过运动检测和帧间融合实现更好的降噪效果。";
                } else if (lowerMessage.includes('hdr') || lowerMessage.includes('高动态')) {
                    return "HDR(高动态范围)技术通过融合多帧不同曝光时间的图像来扩展图像的动态范围，使亮部和暗部细节都能得到较好保留。";
                } else if (lowerMessage.includes('传感器') || lowerMessage.includes('sensor')) {
                    return "图像传感器是将光信号转换为电信号的设备，主要有CMOS和CCD两种类型。CMOS传感器因其低功耗和高集成度而被广泛应用于现代相机中。";
                } else if (lowerMessage.includes('谢谢') || lowerMessage.includes('感谢')) {
                    return "不客气！如果您还有其他关于ISP的问题，随时可以问我。";
                } else {
                    const responses = [
                        "这是一个很好的问题！ISP技术涉及很多方面，包括图像处理算法、硬件架构等。",
                        "关于ISP技术，我可以告诉您它在数字成像中起着至关重要的作用，负责将原始传感器数据转换为高质量的图像。",
                        "ISP(图像信号处理器)是现代相机系统的核心组件，它执行从去马赛克到白平衡等多种图像处理任务。",
                        "如果您对ISP的某个特定方面感兴趣，比如色彩处理或噪声消除，请具体说明，我可以提供更详细的信息。"
                    ];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            // 重置窗口位置到默认位置
            function resetPosition() {
                xOffset = 0;
                yOffset = 0;
                chatbotModal.style.transform = "translate(0, 0)";
            }
            
            // 拖动功能实现
            chatbotHeader.addEventListener("mousedown", dragStart);
            document.addEventListener("mousemove", drag);
            document.addEventListener("mouseup", dragEnd);
            
            // 移动端触摸事件支持
            chatbotHeader.addEventListener("touchstart", dragStart, false);
            document.addEventListener("touchmove", drag, false);
            document.addEventListener("touchend", dragEnd, false);
            
            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                
                if (e.target === chatbotHeader) {
                    isDragging = true;
                    dragStartX = e.clientX || e.touches[0].clientX;
                    dragStartY = e.clientY || e.touches[0].clientY;
                }
            }
            
            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    
                    xOffset = currentX;
                    yOffset = currentY;
                    
                    // 实时更新位置
                    chatbotModal.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
            
            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                
                // 拖动结束后检查是否需要吸附到边缘
                if (chatbotModal.classList.contains('show')) {
                    snapToEdge();
                }
            }
            
            // 边缘吸附功能
            function snapToEdge() {
                const modalRect = chatbotModal.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                
                // 计算吸附位置
                let newX = xOffset;
                let newY = yOffset;
                
                // 右边缘吸附并展开
                if (Math.abs(modalRect.right - windowWidth) < 30) {
                    newX = windowWidth - chatbotModal.offsetWidth - 10;
                    // 展开窗口到边缘
                    expandToEdge('right');
                }
                // 左边缘吸附并展开
                else if (Math.abs(modalRect.left) < 30) {
                    newX = 10;
                    // 展开窗口到边缘
                    expandToEdge('left');
                }
                
                // 下边缘吸附并展开
                if (Math.abs(modalRect.bottom - windowHeight) < 30) {
                    newY = windowHeight - chatbotModal.offsetHeight - 10;
                    // 展开窗口到边缘
                    expandToEdge('bottom');
                }
                // 上边缘吸附并展开
                else if (Math.abs(modalRect.top) < 30) {
                    newY = 10;
                    // 展开窗口到边缘
                    expandToEdge('top');
                }
                
                // 应用吸附动画
                if (newX !== xOffset || newY !== yOffset) {
                    xOffset = newX;
                    yOffset = newY;
                    chatbotModal.style.transition = "transform 0.3s ease";
                    chatbotModal.style.transform = `translate(${newX}px, ${newY}px)`;
                    
                    // 动画结束后移除过渡效果
                    setTimeout(() => {
                        chatbotModal.style.transition = "none";
                    }, 300);
                }
            }
            
            // 展开到边缘功能
            function expandToEdge(edge) {
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                const currentWidth = chatbotModal.offsetWidth;
                const currentHeight = chatbotModal.offsetHeight;
                
                // 根据边缘方向展开窗口
                switch(edge) {
                    case 'right':
                        // 展开到右边缘
                        chatbotModal.style.width = (windowWidth - 20) + 'px';
                        break;
                    case 'left':
                        // 展开到左边缘（保持右边缘位置）
                        chatbotModal.style.width = (windowWidth - 20) + 'px';
                        break;
                    case 'bottom':
                        // 展开到底部边缘
                        chatbotModal.style.height = (windowHeight - 20) + 'px';
                        break;
                    case 'top':
                        // 展开到顶部边缘（保持底部位置）
                        chatbotModal.style.height = (windowHeight - 20) + 'px';
                        break;
                }
            }
            
            // 窗口大小改变时重新检查位置
            window.addEventListener('resize', function() {
                if (chatbotModal.classList.contains('show')) {
                    snapToEdge();
                }
            });
        });
        </script>


    <div class="container">
        <div class="header">
            <h1>ISP图像处理知识库</h1>
            <p>Image Signal Processor 图像信号处理器完整知识体系</p>
        </div>

        <div id="knowledge-grid" class="knowledge-grid">
            <!-- 知识点将通过JavaScript动态生成 -->
        </div>

        <div class="flow-diagram">
            <div class="flow-header">
                <div class="flow-title">🏗️ ISP架构图</div>
                <div class="flow-controls">
                    <div class="version-selector">
                        <label for="version-select">版本选择:</label>
                        <select id="version-select">
                            <option value="flowData">标准版本</option>
                            <option value="flowData1">版本1</option>
                            <option value="flowData2">版本2</option>
                        </select>
                    </div>
                    <div class="compare-controls">
                        <button id="compare-btn" class="compare-btn">对比模式</button>
                        <div id="compare-panel" class="compare-panel" style="display: none;">
                            <div class="compare-title">选择要对比的版本:</div>
                            <div class="compare-options">
                                <label><input type="checkbox" value="flowData"> 标准版本</label>
                                <label><input type="checkbox" value="flowData1"> 版本1</label>
                                <label><input type="checkbox" value="flowData2"> 版本2</label>
                            </div>
                            <button id="start-compare" class="start-compare-btn">开始对比</button>
                            <button id="cancel-compare" class="cancel-compare-btn">取消</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="flow-container" class="flow-container">
                <!-- 架构图将通过JavaScript动态生成 -->
            </div>
        </div>

        <div class="footer">
            <p>© 2024 ISP图像处理知识库 | 专业图像信号处理技术分享平台</p>
        </div>

        <!-- 硬件模块详情弹窗 -->
        <div id="module-modal" class="module-modal">
            <div class="module-modal-content">
                <div class="module-modal-header">
                    <h2 class="module-modal-title" id="modal-title">模块详情</h2>
                    <button class="module-modal-close" id="modal-close">&times;</button>
                </div>
                <div id="modal-content">
                    <!-- 弹窗内容将通过JavaScript动态生成 -->
                </div>
                <div class="module-modal-footer">
                    <a href="#" id="modal-more-link" class="module-modal-more-btn" target="_blank">
                        点击查看更多
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 知识点数据配置
        const knowledgeData = {
            // 相机成像原理
            "camera-imaging": {
                title: "📷 相机成像原理",
                items: [
                    {
                        title: "光学系统",
                        description: "镜头组、光圈、焦距等光学元件组成成像系统",
                        status: "completed"
                    },
                    {
                        title: "感光元件",
                        description: "CMOS/CCD传感器将光信号转换为电信号",
                        status: "completed"
                    },
                    {
                        title: "光电转换",
                        description: "光子激发电子，产生电荷积累和电压信号",
                        status: "completed"
                    },
                    {
                        title: "采样量化",
                        description: "空间和时间维度的离散化采样过程",
                        status: "pending"
                    },
                    {
                        title: "色彩滤波",
                        description: "Bayer阵列等色彩滤镜实现色彩分离",
                        status: "completed"
                    },
                    {
                        title: "噪声来源",
                        description: "光子噪声、暗电流噪声、读出噪声等",
                        status: "pending"
                    }
                ]
            },
            
            // ISP处理算法
            "isp-algorithms": {
                title: "🔬 ISP处理算法",
                items: [
                    {
                        title: "去马赛克",
                        description: "Demosaic算法从Bayer阵列重建全彩图像",
                        status: "completed"
                    },
                    {
                        title: "白平衡",
                        description: "调整RGB通道比例，校正色温偏差",
                        status: "completed"
                    },
                    {
                        title: "降噪算法",
                        description: "双边滤波、非局部均值等降噪技术",
                        status: "completed"
                    },
                    {
                        title: "色彩校正",
                        description: "色彩空间转换和色彩增强处理",
                        status: "completed"
                    },
                    {
                        title: "锐化增强",
                        description: "拉普拉斯算子、USM等锐化算法",
                        status: "pending"
                    },
                    {
                        title: "伽马校正",
                        description: "非线性亮度调整，适应人眼视觉特性",
                        status: "completed"
                    }
                ]
            },
            
            // ISP处理通路
            "isp-pipeline": {
                title: "🔄 ISP处理通路",
                items: [
                    {
                        title: "原始数据",
                        description: "Raw格式图像数据，包含传感器原始信息",
                        status: "completed"
                    },
                    {
                        title: "预处理",
                        description: "黑电平校正、坏点检测、镜头阴影校正",
                        status: "completed"
                    },
                    {
                        title: "去马赛克",
                        description: "色彩插值，重建完整RGB图像",
                        status: "completed"
                    },
                    {
                        title: "色彩处理",
                        description: "白平衡、色彩校正、饱和度调整",
                        status: "completed"
                    },
                    {
                        title: "图像增强",
                        description: "降噪、锐化、对比度增强等",
                        status: "completed"
                    },
                    {
                        title: "后处理",
                        description: "伽马校正、压缩编码、格式转换",
                        status: "completed"
                    },
                    // 新增AI处理模块
                    {
                        title: "AI处理模块",
                        description: "深度学习算法进行图像质量增强和智能优化",
                        status: "future"
                    }
                ]
            },
            
            // 软件开发技术栈
            "software-stack": {
                title: "💻 软件开发技术栈",
                items: [
                    {
                        title: "编程语言",
                        description: "C/C++、Python、MATLAB等高性能语言",
                        status: "completed"
                    },
                    {
                        title: "图像处理库",
                        description: "OpenCV、PIL、scikit-image等",
                        status: "completed"
                    },
                    {
                        title: "并行计算",
                        description: "OpenCL、CUDA、SIMD指令集优化",
                        status: "pending"
                    },
                    {
                        title: "算法优化",
                        description: "内存管理、缓存优化、算法复杂度",
                        status: "future"
                    },
                    {
                        title: "硬件加速",
                        description: "DSP、GPU、FPGA等专用硬件",
                        status: "completed"
                    },
                    {
                        title: "开发工具",
                        description: "调试器、性能分析器、代码优化工具",
                        status: "future"
                    }
                ]
            }
        };
        // ISP硬件架构图数据配置 - 根据dataflow.png设计
        const flowData = {
            // 传感器输入
            sensor: {
                title: "传感器输入",
                items: [
                    {
                        id: "mipi-receiver",
                        title: "MIPI CSI-2接收器",
                        description: "接收传感器数据",
                        type: "sensor"
                    },
                    {
                        id: "raw-data",
                        title: "RAW12/14bit数据",
                        description: "原始传感器数据",
                        type: "sensor"
                    }
                ]
            },
            
            // RAW域处理
            raw: {
                title: "RAW域处理",
                items: [
                    {
                        id: "blc",
                        title: "黑电平校正 BLC",
                        description: "校正暗电流",
                        type: "raw"
                    },
                    {
                        id: "lsc",
                        title: "镜头阴影校正 LSC",
                        description: "校正镜头阴影",
                        type: "raw"
                    },
                    {
                        id: "dpc",
                        title: "坏点校正 DPC",
                        description: "检测修复坏点",
                        type: "raw"
                    },
                    {
                        id: "hdr-fusion",
                        title: "HDR融合引擎",
                        description: "多帧融合",
                        type: "raw"
                    }
                ]
            },
            
            // RGB域处理
            rgb: {
                title: "RGB域处理",
                items: [
                    {
                        id: "demosaic",
                        title: "去马赛克 Demosaic",
                        description: "色彩重建",
                        type: "rgb"
                    },
                    {
                        id: "awb",
                        title: "自动白平衡 AWB",
                        description: "色温校正",
                        type: "rgb"
                    },
                    {
                        id: "ccm",
                        title: "色彩校正矩阵 CCM",
                        description: "色彩空间转换",
                        type: "rgb"
                    },
                    {
                        id: "gamma",
                        title: "Gamma校正",
                        description: "非线性校正",
                        type: "rgb"
                    }
                ]
            },
            
            // YUV域处理
            yuv: {
                title: "YUV域处理",
                items: [
                    {
                        id: "rgb2yuv",
                        title: "RGB→YUV转换",
                        description: "色彩空间转换",
                        type: "yuv"
                    },
                    {
                        id: "noise-reduction",
                        title: "2D/3D降噪",
                        description: "图像降噪",
                        type: "yuv"
                    },
                    {
                        id: "sharpening",
                        title: "图像锐化",
                        description: "边缘增强",
                        type: "yuv"
                    },
                    {
                        id: "scale",
                        title: "缩放 Scale",
                        description: "分辨率调整",
                        type: "yuv"
                    }
                ]
            },
            
            // 输出
            output: {
                title: "输出",
                items: [
                    {
                        id: "mipi-transmitter",
                        title: "MIPI CSI-2发射器",
                        description: "输出图像数据",
                        type: "output"
                    },
                    {
                        id: "video-encoder",
                        title: "视频编码器",
                        description: "编码压缩",
                        type: "output"
                    }
                ]
            },
            
            // 内存子系统
            memory: {
                title: "内存子系统",
                items: [
                    {
                        id: "ddr-controller",
                        title: "DDR控制器",
                        description: "内存访问控制",
                        type: "memory"
                    }
                ]
            }
        };

        const flowData1 = {
            // 传感器输入
            sensor: {
                title: "传感器输入",
                items: [
                    {
                        id: "mipi-receiver",
                        title: "MIPI CSI-2接收器",
                        description: "接收传感器数据",
                        type: "sensor"
                    },
                    {
                        id: "raw-data",
                        title: "RAW12/14bit数据",
                        description: "原始传感器数据",
                        type: "sensor"
                    }
                ]
            },
            
            // RAW域处理
            raw: {
                title: "RAW域处理",
                items: [
                    {
                        id: "blc",
                        title: "黑电平校正 BLC",
                        description: "校正暗电流",
                        type: "raw"
                    },
                    {
                        id: "lsc",
                        title: "镜头阴影校正 LSC",
                        description: "校正镜头阴影",
                        type: "raw"
                    },
                    {
                        id: "dpc",
                        title: "坏点校正 DPC",
                        description: "检测修复坏点",
                        type: "raw"
                    }
                ]
            },
            
            // RGB域处理
            rgb: {
                title: "RGB域处理",
                items: [
                    {
                        id: "demosaic",
                        title: "去马赛克 Demosaic",
                        description: "色彩重建",
                        type: "rgb"
                    },
                    {
                        id: "awb",
                        title: "自动白平衡 AWB",
                        description: "色温校正",
                        type: "rgb"
                    },
                    {
                        id: "ccm",
                        title: "色彩校正矩阵 CCM",
                        description: "色彩空间转换",
                        type: "rgb"
                    },
                    {
                        id: "gamma",
                        title: "Gamma校正",
                        description: "非线性校正",
                        type: "rgb"
                    }
                ]
            },
            
            // YUV域处理
            yuv: {
                title: "YUV域处理",
                items: [
                    {
                        id: "rgb2yuv",
                        title: "RGB→YUV转换",
                        description: "色彩空间转换",
                        type: "yuv"
                    },
                    {
                        id: "noise-reduction",
                        title: "2D/3D降噪",
                        description: "图像降噪",
                        type: "yuv"
                    },
                    {
                        id: "sharpening",
                        title: "图像锐化",
                        description: "边缘增强",
                        type: "yuv"
                    },
                    {
                        id: "scale",
                        title: "缩放 Scale2",
                        description: "分辨率调整",
                        type: "yuv"
                    }
                ]
            },
            
            // 输出
            output: {
                title: "输出",
                items: [
                    {
                        id: "mipi-transmitter",
                        title: "MIPI CSI-2发射器",
                        description: "输出图像数据",
                        type: "output"
                    },
                    {
                        id: "video-encoder",
                        title: "视频编码器",
                        description: "编码压缩",
                        type: "output"
                    }
                ]
            },
            
            // 内存子系统
            memory: {
                title: "内存子系统",
                items: [
                    {
                        id: "ddr-controller",
                        title: "DDR控制器",
                        description: "内存访问控制",
                        type: "memory"
                    }
                ]
            }
        };
        const flowData2 = {
            // 传感器输入
            sensor: {
                title: "传感器输入",
                items: [
                    {
                        id: "mipi-receiver",
                        title: "MIPI CSI-2接收器",
                        description: "接收传感器数据",
                        type: "sensor"
                    },
                    {
                        id: "raw-data",
                        title: "RAW12/14bit数据",
                        description: "原始传感器数据",
                        type: "sensor"
                    }
                ]
            },
            
            // RAW域处理
            raw: {
                title: "RAW域处理",
                items: [
                    {
                        id: "blc",
                        title: "黑电平校正 BLC",
                        description: "校正暗电流",
                        type: "raw"
                    },
                    {
                        id: "lsc",
                        title: "镜头阴影校正 LSC",
                        description: "校正镜头阴影",
                        type: "raw"
                    },
                    {
                        id: "dpc",
                        title: "坏点校正 DPC",
                        description: "检测修复坏点",
                        type: "raw"
                    }
                ]
            },
            
            // RGB域处理
            rgb: {
                title: "RGB域处理",
                items: [
                    {
                        id: "AI mod2",
                        title: "AI MOD",
                        description: "新增的AI模块",
                        type: "rgb"
                    },
                    {
                        id: "demosaic",
                        title: "去马赛克 Demosaic",
                        description: "色彩重建",
                        type: "rgb"
                    },
                    {
                        id: "awb",
                        title: "自动白平衡 AWB",
                        description: "色温校正",
                        type: "rgb"
                    },
                    {
                        id: "ccm",
                        title: "色彩校正矩阵 CCM",
                        description: "色彩空间转换",
                        type: "rgb"
                    },
                    {
                        id: "gamma",
                        title: "Gamma校正",
                        description: "非线性校正",
                        type: "rgb"
                    }
                ]
            },
            
            // YUV域处理
            yuv: {
                title: "YUV域处理",
                items: [
                    {
                        id: "rgb2yuv",
                        title: "RGB→YUV转换",
                        description: "色彩空间转换",
                        type: "yuv"
                    },
                    {
                        id: "noise-reduction",
                        title: "2D/3D降噪",
                        description: "图像降噪",
                        type: "yuv"
                    },
                    {
                        id: "sharpening",
                        title: "图像锐化",
                        description: "边缘增强",
                        type: "yuv"
                    },
                    {
                        id: "scale",
                        title: "缩放 Scale",
                        description: "分辨率调整",
                        type: "yuv"
                    }
                ]
            },
            
            // 输出
            output: {
                title: "输出",
                items: [
                    {
                        id: "mipi-transmitter",
                        title: "MIPI CSI-2发射器",
                        description: "输出图像数据",
                        type: "output"
                    },
                    {
                        id: "video-encoder",
                        title: "视频编码器",
                        description: "编码压缩",
                        type: "output"
                    }
                ]
            },
            
            // 内存子系统
            memory: {
                title: "内存子系统",
                items: [
                    {
                        id: "ddr-controller",
                        title: "DDR控制器",
                        description: "内存访问控制",
                        type: "memory"
                    }
                ]
            }
                };

        // 硬件模块详细信息数据
        const moduleDetails = {
            // MIPI CSI-2接收器
            "mipi-receiver": {
                title: "MIPI CSI-2接收器",
                introduction: "MIPI CSI-2（Camera Serial Interface 2）接收器是ISP芯片中负责接收传感器数据的核心接口模块。它支持多种数据格式和传输协议，确保高速、可靠的数据传输。",
                principle: "采用差分信号传输技术，通过时钟和数据线的同步传输实现高速串行通信。支持多种数据格式（RAW8/10/12/14bit），具备自动时钟恢复和数据重同步功能。",
                constraints: "需要满足MIPI联盟的电气规范，支持1-4通道传输，最高可达6Gbps传输速率。对信号完整性要求较高，需要精确的阻抗匹配和EMI防护。",
                link: "https://www.mipi.org/specifications/csi-2"
            },
            
            // RAW数据
            "raw-data": {
                title: "RAW12/14bit数据",
                introduction: "RAW格式数据是传感器输出的原始图像数据，包含未经处理的像素信息。12/14bit精度提供了丰富的动态范围和色彩深度。",
                principle: "每个像素包含一个数值，表示该像素位置的光强度。Bayer阵列排列的像素通过不同的色彩滤镜获得对应的色彩信息。",
                constraints: "数据量大，需要高速缓存和传输带宽。对存储空间要求高，需要支持多种数据格式的灵活处理。",
                link: "https://en.wikipedia.org/wiki/Raw_image_format"
            },
            
            // 黑电平校正
            "blc": {
                title: "黑电平校正 BLC",
                introduction: "黑电平校正（Black Level Correction）是ISP处理流程中的第一步，用于校正传感器的暗电流偏移，确保图像的黑电平准确。",
                principle: "通过减去预设的黑电平偏移值，将暗电流产生的基准电平调整到零。可以采用固定值或自适应算法进行校正。",
                constraints: "需要精确的暗电流测量，对温度变化敏感。校正精度直接影响图像的对比度和动态范围。",
                link: "https://en.wikipedia.org/wiki/Black_level"
            },
            
            // 镜头阴影校正
            "lsc": {
                title: "镜头阴影校正 LSC",
                introduction: "镜头阴影校正（Lens Shading Correction）用于补偿镜头的光学特性导致的图像边缘亮度衰减现象。",
                principle: "通过预计算的增益矩阵对图像进行逐像素校正，边缘区域使用较高的增益值来补偿亮度损失。",
                constraints: "需要针对不同镜头进行校准，存储空间要求较高。校正过度可能导致噪声放大。",
                link: "https://en.wikipedia.org/wiki/Vignetting"
            },
            
            // 坏点校正
            "dpc": {
                title: "坏点校正 DPC",
                introduction: "坏点校正（Defective Pixel Correction）用于检测和修复传感器中的坏点，提高图像质量。",
                principle: "通过比较像素值与周围像素的差异来检测坏点，使用插值算法计算坏点的正确值进行替换。",
                constraints: "需要实时处理，算法复杂度影响处理延迟。过度校正可能影响图像细节。",
                link: "https://en.wikipedia.org/wiki/Dead_pixel"
            },
            
            // HDR融合引擎
            "hdr-fusion": {
                title: "HDR融合引擎",
                introduction: "HDR（High Dynamic Range）融合引擎通过融合多帧不同曝光时间的图像，扩展图像的动态范围。",
                principle: "采用权重融合算法，根据像素的饱和度和噪声水平动态调整融合权重，生成高动态范围的图像。",
                constraints: "需要多帧缓存，处理延迟较高。融合算法复杂，对计算资源要求高。",
                link: "https://en.wikipedia.org/wiki/High_dynamic_range"
            },
            
            // 去马赛克
            "demosaic": {
                title: "去马赛克 Demosaic",
                introduction: "去马赛克算法将Bayer阵列的单色像素重建为全彩色图像，是ISP处理流程中的关键步骤。",
                principle: "通过插值算法，利用周围像素的色彩信息来估计缺失的色彩分量。支持多种插值算法如双线性、双三次等。",
                constraints: "算法复杂度影响处理速度，插值质量影响图像清晰度。边缘区域容易出现伪色。",
                link: "https://en.wikipedia.org/wiki/Demosaicing"
            },
            
            // 自动白平衡
            "awb": {
                title: "自动白平衡 AWB",
                introduction: "自动白平衡（Auto White Balance）自动调整图像的色温，使白色物体在不同光照条件下呈现真实的白色。",
                principle: "基于灰度世界假设或白点检测算法，计算RGB通道的增益系数，调整色彩平衡。",
                constraints: "对光照条件敏感，复杂场景下可能出现误判。需要实时调整，算法稳定性要求高。",
                link: "https://en.wikipedia.org/wiki/Color_balance"
            },
            
            // 色彩校正矩阵
            "ccm": {
                title: "色彩校正矩阵 CCM",
                introduction: "色彩校正矩阵（Color Correction Matrix）用于校正传感器的色彩响应，确保色彩还原的准确性。",
                principle: "通过3x3矩阵变换，调整RGB通道之间的比例关系，补偿传感器的色彩偏差。",
                constraints: "需要针对不同传感器进行校准，矩阵系数影响色彩饱和度和色调。",
                link: "https://en.wikipedia.org/wiki/Color_correction"
            },
            
            // Gamma校正
            "gamma": {
                title: "Gamma校正",
                introduction: "Gamma校正用于调整图像的亮度响应曲线，使其符合人眼的视觉特性，提高图像的主观质量。",
                principle: "通过非线性变换函数调整像素值，通常使用幂函数进行校正，补偿显示设备的非线性特性。",
                constraints: "校正参数影响图像对比度，过度校正可能导致细节丢失。",
                link: "https://en.wikipedia.org/wiki/Gamma_correction"
            },
            
            // RGB到YUV转换
            "rgb2yuv": {
                title: "RGB→YUV转换",
                introduction: "RGB到YUV色彩空间转换将RGB图像转换为亮度和色度分离的YUV格式，便于后续处理。",
                principle: "通过线性变换矩阵将RGB值转换为Y（亮度）、U和V（色度）分量，支持多种YUV标准。",
                constraints: "转换精度影响色彩还原质量，需要浮点运算支持。",
                link: "https://en.wikipedia.org/wiki/YUV"
            },
            
            // 降噪
            "noise-reduction": {
                title: "2D/3D降噪",
                introduction: "2D/3D降噪算法用于减少图像噪声，提高图像质量。2D降噪处理单帧，3D降噪利用多帧信息。",
                principle: "2D降噪使用空间滤波算法，3D降噪结合时间域信息，通过运动检测和帧间融合实现降噪。",
                constraints: "3D降噪需要帧缓存，处理延迟较高。降噪强度影响图像细节保留。",
                link: "https://en.wikipedia.org/wiki/Noise_reduction"
            },
            
            // 图像锐化
            "sharpening": {
                title: "图像锐化",
                introduction: "图像锐化算法增强图像的边缘和细节，提高图像的清晰度和视觉冲击力。",
                principle: "通过高通滤波器突出图像的高频成分，常用的有拉普拉斯算子、USM（Unsharp Masking）等。",
                constraints: "锐化过度可能产生振铃效应，增加噪声。需要根据图像内容自适应调整参数。",
                link: "https://en.wikipedia.org/wiki/Unsharp_masking"
            },
            
            // 缩放
            "scale": {
                title: "缩放 Scale",
                introduction: "图像缩放模块用于调整图像分辨率，支持放大和缩小操作，满足不同输出需求。",
                principle: "采用插值算法进行像素重采样，支持最近邻、双线性、双三次等插值方法。",
                constraints: "插值质量影响图像清晰度，计算复杂度随缩放比例增加。",
                link: "https://en.wikipedia.org/wiki/Image_scaling"
            },
            
            // 缩放 Scale2（版本1特有）
            "scale2": {
                title: "缩放 Scale2",
                introduction: "Scale2是版本1中优化的缩放模块，采用改进的插值算法，提供更高质量的图像缩放效果。",
                principle: "结合边缘检测的自适应插值算法，在保持边缘清晰度的同时减少锯齿和振铃效应。",
                constraints: "算法复杂度较高，需要额外的边缘检测计算资源。",
                link: "https://en.wikipedia.org/wiki/Image_scaling"
            },
            
            // 输出发射器
            "mipi-transmitter": {
                title: "MIPI CSI-2发射器",
                introduction: "MIPI CSI-2发射器负责将处理后的图像数据输出到下游设备，如显示控制器或编码器。",
                principle: "将并行数据转换为串行差分信号，支持多种数据格式和传输协议。",
                constraints: "需要满足MIPI电气规范，支持高速传输和多种数据格式。",
                link: "https://www.mipi.org/specifications/csi-2"
            },
            
            // 视频编码器
            "video-encoder": {
                title: "视频编码器",
                introduction: "视频编码器将图像数据压缩编码，减少存储和传输带宽需求，支持多种编码标准。",
                principle: "采用帧内和帧间压缩技术，利用空间和时间相关性进行数据压缩。",
                constraints: "编码质量与压缩率成反比，需要平衡质量和带宽需求。",
                link: "https://en.wikipedia.org/wiki/Video_codec"
            },
            
            // DDR控制器
            "ddr-controller": {
                title: "DDR控制器",
                introduction: "DDR控制器管理外部DDR内存的访问，为ISP处理提供高速数据缓存和帧缓冲。",
                principle: "实现DDR协议，管理地址映射、时序控制和数据缓冲，支持突发传输和预取操作。",
                constraints: "需要满足DDR时序要求，带宽和延迟影响系统性能。",
                link: "https://en.wikipedia.org/wiki/DDR_SDRAM"
            },
            
            // AI模块（版本2新增）
            "AI mod2": {
                title: "AI MOD",
                introduction: "AI模块是新一代ISP芯片中新增的智能处理单元，采用深度学习算法进行图像质量增强和智能优化。",
                principle: "基于卷积神经网络（CNN）的推理引擎，支持多种AI模型，实现智能降噪、超分辨率、场景识别等功能。",
                constraints: "需要较大的片上存储和计算资源，功耗较高。模型精度和推理速度需要平衡。",
                link: "https://en.wikipedia.org/wiki/Artificial_intelligence"
            }
        };
        // 添加悬停弹窗和抽屉菜单功能
        function addHoverPopupAndDrawer() {
            // 知识点详细数据
            const knowledgeDetails = {
                // 相机成像原理类别
                "光学系统": {
                    title: "光学系统",
                    items: [
                        {
                            title: "镜头组",
                            description: "由多个透镜组成的光学系统，用于聚焦光线到传感器上",
                            link: "https://en.wikipedia.org/wiki/Camera_lens"
                        },
                        {
                            title: "光圈",
                            description: "控制进入镜头的光量，影响景深和曝光",
                            link: "https://en.wikipedia.org/wiki/Aperture"
                        },
                        {
                            title: "焦距",
                            description: "镜头中心到传感器的距离，决定视角和放大率",
                            link: "https://en.wikipedia.org/wiki/Focal_length"
                        },
                        {
                            title: "畸变校正",
                            description: "校正镜头产生的几何畸变，如桶形畸变和枕形畸变",
                            link: "https://en.wikipedia.org/wiki/Distortion_(optics)"
                        }
                    ]
                },
                "感光元件": {
                    title: "感光元件",
                    items: [
                        {
                            title: "CMOS传感器",
                            description: "互补金属氧化物半导体传感器，现代相机中最常用的图像传感器",
                            link: "https://en.wikipedia.org/wiki/CMOS_sensor"
                        },
                        {
                            title: "CCD传感器",
                            description: "电荷耦合器件传感器，具有高灵敏度和低噪声特性",
                            link: "https://en.wikipedia.org/wiki/Charge-coupled_device"
                        },
                        {
                            title: "像素结构",
                            description: "单个感光单元的物理结构和工作原理",
                            link: "https://en.wikipedia.org/wiki/Photosite"
                        },
                        {
                            title: "量子效率",
                            description: "传感器将光子转换为电子的效率指标",
                            link: "https://en.wikipedia.org/wiki/Quantum_efficiency"
                        }
                    ]
                },
                "光电转换": {
                    title: "光电转换",
                    items: [
                        {
                            title: "光电效应",
                            description: "光子激发电子产生电流的物理现象",
                            link: "https://en.wikipedia.org/wiki/Photoelectric_effect"
                        },
                        {
                            title: "电荷积累",
                            description: "光电子在像素中积累形成电荷包的过程",
                            link: "https://en.wikipedia.org/wiki/Charge_coupling"
                        },
                        {
                            title: "电压信号",
                            description: "电荷转换为电压信号供后续电路处理",
                            link: "https://en.wikipedia.org/wiki/Voltage"
                        }
                    ]
                },
                "色彩滤波": {
                    title: "色彩滤波",
                    items: [
                        {
                            title: "Bayer阵列",
                            description: "最常见的色彩滤镜阵列，按RGGB模式排列",
                            link: "https://en.wikipedia.org/wiki/Bayer_filter"
                        },
                        {
                            title: "色彩插值",
                            description: "通过算法重建全彩色图像的过程",
                            link: "https://en.wikipedia.org/wiki/Demosaicing"
                        }
                    ]
                },
                
                // ISP处理算法类别
                "去马赛克": {
                    title: "去马赛克",
                    items: [
                        {
                            title: "Bilinear插值",
                            description: "双线性插值算法，简单快速但精度有限",
                            link: "https://en.wikipedia.org/wiki/Bilinear_interpolation"
                        },
                        {
                            title: "边缘感知插值",
                            description: "根据边缘方向进行插值，减少伪色",
                            link: "https://en.wikipedia.org/wiki/Demosaicing#Edge-directed_interpolation"
                        },
                        {
                            title: "自适应插值",
                            description: "根据局部图像特征自适应选择插值方法",
                            link: "https://en.wikipedia.org/wiki/Demosaicing#Adaptive_filtering"
                        }
                    ]
                },
                "白平衡": {
                    title: "白平衡",
                    items: [
                        {
                            title: "灰度世界算法",
                            description: "假设场景中所有颜色平均值为灰色",
                            link: "https://en.wikipedia.org/wiki/Color_balance#Gray_world_assumption"
                        },
                        {
                            title: "完美反射算法",
                            description: "假设场景中存在完美反射体",
                            link: "https://en.wikipedia.org/wiki/Color_balance#Perfect_reflector_assumption"
                        },
                        {
                            title: "基于学习的方法",
                            description: "使用机器学习模型预测白平衡参数",
                            link: "https://en.wikipedia.org/wiki/Color_balance#Learning-based_methods"
                        }
                    ]
                },
                "降噪算法": {
                    title: "降噪算法",
                    items: [
                        {
                            title: "空间域降噪",
                            description: "基于像素邻域信息进行降噪处理",
                            link: "https://en.wikipedia.org/wiki/Noise_reduction#Spatial_filtering"
                        },
                        {
                            title: "时间域降噪",
                            description: "利用多帧图像信息进行降噪",
                            link: "https://en.wikipedia.org/wiki/Noise_reduction#Temporal_filtering"
                        },
                        {
                            title: "混合降噪",
                            description: "结合空间和时间信息的降噪方法",
                            link: "https://en.wikipedia.org/wiki/Noise_reduction#Hybrid_methods"
                        }
                    ]
                },
                "色彩校正": {
                    title: "色彩校正",
                    items: [
                        {
                            title: "色彩校正矩阵(CCM)",
                            description: "使用3x3矩阵校正色彩偏差",
                            link: "https://en.wikipedia.org/wiki/Color_correction_matrix"
                        },
                        {
                            title: "色调映射",
                            description: "调整图像的色调和饱和度",
                            link: "https://en.wikipedia.org/wiki/Tone_mapping"
                        },
                        {
                            title: "色彩空间转换",
                            description: "在不同色彩空间之间转换",
                            link: "https://en.wikipedia.org/wiki/Color_space"
                        }
                    ]
                },
                "伽马校正": {
                    title: "伽马校正",
                    items: [
                        {
                            title: "伽马编码",
                            description: "对图像进行非线性亮度编码",
                            link: "https://en.wikipedia.org/wiki/Gamma_correction#Encoding"
                        },
                        {
                            title: "伽马解码",
                            description: "还原图像的线性亮度信息",
                            link: "https://en.wikipedia.org/wiki/Gamma_correction#Decoding"
                        },
                        {
                            title: "sRGB标准",
                            description: "标准的RGB色彩空间伽马值",
                            link: "https://en.wikipedia.org/wiki/SRGB"
                        }
                    ]
                },
                
                // ISP处理通路类别
                "原始数据": {
                    title: "原始数据",
                    items: [
                        {
                            title: "RAW格式",
                            description: "传感器直接输出的原始数据格式",
                            link: "https://en.wikipedia.org/wiki/Raw_image_format"
                        },
                        {
                            title: "数据打包",
                            description: "将原始数据按特定格式打包存储",
                            link: "https://en.wikipedia.org/wiki/Image_file_format"
                        },
                        {
                            title: "元数据",
                            description: "与图像数据相关的附加信息",
                            link: "https://en.wikipedia.org/wiki/Exif"
                        }
                    ]
                },
                "预处理": {
                    title: "预处理",
                    items: [
                        {
                            title: "黑电平校正",
                            description: "校正传感器暗电流产生的偏移",
                            link: "https://en.wikipedia.org/wiki/Black_level"
                        },
                        {
                            title: "坏点校正",
                            description: "检测并修复传感器中的坏点",
                            link: "https://en.wikipedia.org/wiki/Dead_pixel"
                        },
                        {
                            title: "镜头阴影校正",
                            description: "补偿镜头造成的亮度衰减",
                            link: "https://en.wikipedia.org/wiki/Vignetting"
                        }
                    ]
                },
                "图像增强": {
                    title: "图像增强",
                    items: [
                        {
                            title: "对比度增强",
                            description: "调整图像明暗对比关系",
                            link: "https://en.wikipedia.org/wiki/Contrast_(vision)#Contrast_enhancement"
                        },
                        {
                            title: "锐化处理",
                            description: "增强图像边缘和细节信息",
                            link: "https://en.wikipedia.org/wiki/Unsharp_masking"
                        },
                        {
                            title: "动态范围调整",
                            description: "优化图像的亮度动态范围",
                            link: "https://en.wikipedia.org/wiki/Tone_mapping"
                        }
                    ]
                },
                
                // 软件开发技术栈类别
                "编程语言": {
                    title: "编程语言",
                    items: [
                        {
                            title: "C/C++",
                            description: "系统级编程语言，性能优异",
                            link: "https://en.wikipedia.org/wiki/C_(programming_language)"
                        },
                        {
                            title: "Python",
                            description: "高级脚本语言，开发效率高",
                            link: "https://en.wikipedia.org/wiki/Python_(programming_language)"
                        },
                        {
                            title: "MATLAB",
                            description: "科学计算和算法验证平台",
                            link: "https://en.wikipedia.org/wiki/MATLAB"
                        }
                    ]
                },
                "图像处理库": {
                    title: "图像处理库",
                    items: [
                        {
                            title: "OpenCV",
                            description: "开源计算机视觉库",
                            link: "https://en.wikipedia.org/wiki/OpenCV"
                        },
                        {
                            title: "ImageMagick",
                            description: "图像处理工具集",
                            link: "https://en.wikipedia.org/wiki/ImageMagick"
                        },
                        {
                            title: "VIPS",
                            description: "高性能图像处理系统",
                            link: "https://en.wikipedia.org/wiki/VIPS_(software)"
                        }
                    ]
                },
                "硬件加速": {
                    title: "硬件加速",
                    items: [
                        {
                            title: "GPU计算",
                            description: "利用图形处理器进行并行计算",
                            link: "https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units"
                        },
                        {
                            title: "DSP处理器",
                            description: "数字信号处理器专用架构",
                            link: "https://en.wikipedia.org/wiki/Digital_signal_processor"
                        },
                        {
                            title: "FPGA加速",
                            description: "现场可编程门阵列硬件加速",
                            link: "https://en.wikipedia.org/wiki/Field-programmable_gate_array"
                        }
                    ]
                }
            };
            // 为知识点添加悬停事件
            const knowledgeItems = document.querySelectorAll('.knowledge-item');
            
            knowledgeItems.forEach(item => {
                const title = item.querySelector('h3').textContent;
                
                // 创建悬停弹窗
                const popup = document.createElement('div');
                popup.className = 'hover-popup';
                document.body.appendChild(popup);
                
                let popupTimeout;
                
                item.addEventListener('mouseenter', function(e) {
                    if (knowledgeDetails[title]) {
                        // 生成弹窗内容
                        popup.innerHTML = `
                            <div class="popup-title">${knowledgeDetails[title].title} 相关知识点</div>
                            <div class="popup-content">
                                ${knowledgeDetails[title].items.map(detail => `
                                    <div class="popup-item">
                                        <div class="popup-item-title">${detail.title}</div>
                                        <div class="popup-item-description">${detail.description}</div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        
                        // 定位弹窗
                        const rect = item.getBoundingClientRect();
                        popup.style.left = rect.left + 'px';
                        popup.style.top = (rect.top + rect.height) + 'px';
                        
                        // 显示弹窗
                        clearTimeout(popupTimeout);
                        popupTimeout = setTimeout(() => {
                            popup.classList.add('show');
                        }, 300);
                    }
                });
                
                item.addEventListener('mouseleave', function() {
                    clearTimeout(popupTimeout);
                    popupTimeout = setTimeout(() => {
                        popup.classList.remove('show');
                    }, 100);
                });
                
                // 点击事件 - 打开抽屉菜单
                item.addEventListener('click', function(e) {
                    e.preventDefault(); // 阻止默认跳转行为
                    if (knowledgeDetails[title]) {
                        showDrawerMenu(knowledgeDetails[title]);
                        // 隐藏弹窗
                        popup.classList.remove('show');
                    }
                });
                
                // 弹窗点击事件 - 转换为抽屉菜单
                popup.addEventListener('click', function(e) {
                    if (knowledgeDetails[title]) {
                        showDrawerMenu(knowledgeDetails[title]);
                        // 隐藏弹窗
                        popup.classList.remove('show');
                    }
                });
            });
        }

        // 更新抽屉菜单内容
        function updateDrawerContent(drawer, data) {
            // 更新标题
            const titleElement = drawer.querySelector('.drawer-title');
            if (titleElement) {
                titleElement.textContent = `${data.title} 详细知识点`;
            }
            
            // 更新内容区域
            const contentElement = drawer.querySelector('.drawer-content');
            if (contentElement) {
                contentElement.innerHTML = data.items.map(item => `
                    <div class="drawer-item">
                        <div class="drawer-item-title">
                            ${item.title}
                            <a href="${item.link}" target="_blank" class="drawer-more-link">查看更多 ></a>
                        </div>
                        <div class="drawer-item-description">${item.description}</div>
                    </div>
                `).join('');
            }
            
            // 重新绑定"查看更多"链接事件（如果需要）
            const moreLinks = drawer.querySelectorAll('.drawer-more-link');
            moreLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // 可以在这里添加特定的处理逻辑
                });
            });
        }

        // 显示抽屉菜单
        function showDrawerMenu(data) {
            // 检查是否已经存在抽屉菜单
            const existingDrawer = document.getElementById('knowledge-drawer');
            
            if (existingDrawer) {
                // 如果已存在抽屉菜单，直接更新内容
                updateDrawerContent(existingDrawer, data);
            } else {
                // 如果不存在，创建新的抽屉菜单
                createNewDrawer(data);
            }
        }

        // 关闭抽屉菜单
        function closeDrawerMenu(drawer, callback) {
            if (!drawer) return;
            
            drawer.classList.remove('open');
            
            // 动画结束后移除元素
            setTimeout(() => {
                if (drawer.parentNode) {
                    drawer.parentNode.removeChild(drawer);
                }
                // 如果有回调函数，执行回调
                if (callback && typeof callback === 'function') {
                    callback();
                }
            }, 400);
        }

        function createNewDrawer(data) {
            // 创建抽屉菜单
            const drawer = document.createElement('div');
            drawer.className = 'drawer-menu';
            drawer.id = 'knowledge-drawer';
            
            drawer.innerHTML = `
                <div class="drawer-header">
                    <h2 class="drawer-title">${data.title} 详细知识点</h2>
                    <button class="drawer-close" id="drawer-close">&times;</button>
                </div>
                <div class="drawer-content">
                    ${data.items.map(item => `
                        <div class="drawer-item">
                            <div class="drawer-item-title">
                                ${item.title}
                                <a href="${item.link}" target="_blank" class="drawer-more-link">查看更多 ></a>
                            </div>
                            <div class="drawer-item-description">${item.description}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.body.appendChild(drawer);
            
            // 触发打开动画
            setTimeout(() => {
                drawer.classList.add('open');
            }, 10);
            
            // 关闭按钮事件
            const closeBtn = drawer.querySelector('#drawer-close');
            closeBtn.addEventListener('click', function() {
                closeDrawerMenu(drawer);
            });
            
            // 点击外部关闭
            drawer.addEventListener('click', function(e) {
                if (e.target === drawer) {
                    closeDrawerMenu(drawer);
                }
            });
            
            // ESC键关闭
            function handleEscKey(e) {
                if (e.key === 'Escape') {
                    closeDrawerMenu(drawer);
                    document.removeEventListener('keydown', handleEscKey);
                }
            }
            document.addEventListener('keydown', handleEscKey);
        }

        // 渲染知识点区块
        function renderKnowledgeSections() {
            const container = document.getElementById('knowledge-grid');
            container.innerHTML = '';

            Object.values(knowledgeData).forEach(section => {
                const sectionElement = document.createElement('div');
                sectionElement.className = 'knowledge-section';
                
                sectionElement.innerHTML = `
                    <div class="section-title">${section.title}</div>
                    <div class="knowledge-items">
                        ${section.items.map(item => `
                            <div class="knowledge-item ${item.status}" data-title="${item.title}" data-description="${item.description}">
                                <div class="status-badge ${item.status}">
                                    ${item.status === 'completed' ? '✓' : item.status === 'pending' ? '?' : '⏳'}
                                </div>
                                <h3>${item.title}</h3>
                                <p>${item.description}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(sectionElement);
            });
        }

        // 渲染ISP架构图 - 水平流水线布局
        function renderFlowDiagram(selectedVersion = 'flowData') {
            console.log(`开始渲染版本: ${selectedVersion}`);
            
            const container = document.getElementById('flow-container');
            if (!container) {
                console.error('找不到 flow-container 元素');
                return;
            }
            
            container.innerHTML = '';
            
            // 获取选中的版本数据
            let currentFlowData;
            switch(selectedVersion) {
                case 'flowData':
                    currentFlowData = flowData;
                    break;
                case 'flowData1':
                    currentFlowData = flowData1;
                    break;
                case 'flowData2':
                    currentFlowData = flowData2;
                    break;
                default:
                    console.error(`版本 ${selectedVersion} 不存在`);
                    return;
            }
            
            if (!currentFlowData) {
                console.error(`版本 ${selectedVersion} 数据无效`);
                return;
            }
            
            console.log('当前版本数据:', currentFlowData);

            // 创建主流水线容器
            const mainPipeline = document.createElement('div');
            mainPipeline.className = 'flow-main-pipeline';
            
            // 创建水平流水线布局
            const domains = ['sensor', 'raw', 'rgb', 'yuv', 'output'];
            
            domains.forEach((domainKey, index) => {
                const domain = currentFlowData[domainKey];
                if (!domain || !domain.items || domain.items.length === 0) {
                    console.warn(`域 ${domainKey} 不存在或为空`);
                    return;
                }
                
                // 创建域容器
                const domainContainer = document.createElement('div');
                domainContainer.className = 'flow-subgraph';
                domainContainer.style.minWidth = '180px';
                
                // 域标题
                domainContainer.innerHTML = `
                    <div class="flow-subgraph-title">${domain.title}</div>
                    <div class="flow-row">
                        ${domain.items.map(item => `
                            <div class="flow-step ${item.type}" data-id="${item.id}" data-title="${item.title}" data-description="${item.description}">
                                <h3>${item.title}</h3>
                                <p>${item.description}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                mainPipeline.appendChild(domainContainer);
                
                // 在域之间添加箭头（除了最后一个域）
                if (index < domains.length - 1) {
                    const arrow = document.createElement('div');
                    arrow.className = 'flow-arrow';
                    arrow.style.margin = '0 10px';
                    mainPipeline.appendChild(arrow);
                }
            });

            // 将主流水线添加到容器
            container.appendChild(mainPipeline);

            // 创建基础设施列（右侧）
            const infrastructure = document.createElement('div');
            infrastructure.className = 'flow-infrastructure';
            
            // 基础设施标题
            const infrastructureTitle = document.createElement('div');
            infrastructureTitle.className = 'infrastructure-title';
            infrastructureTitle.textContent = '🏗️ 基础设施';
            infrastructure.appendChild(infrastructureTitle);

            // 内存子系统
            if (currentFlowData.memory && currentFlowData.memory.items && currentFlowData.memory.items.length > 0) {
                const memoryContainer = document.createElement('div');
                memoryContainer.className = 'flow-subgraph';
                memoryContainer.style.minWidth = '180px';
                memoryContainer.style.border = '2px dashed #ffc107';
                memoryContainer.style.background = 'rgba(255, 193, 7, 0.1)';
                
                memoryContainer.innerHTML = `
                    <div class="flow-subgraph-title">${currentFlowData.memory.title}</div>
                    <div class="flow-row">
                        ${currentFlowData.memory.items.map(item => `
                            <div class="flow-step ${item.type}" data-id="${item.id}" data-title="${item.title}" data-description="${item.description}">
                                <h3>${item.title}</h3>
                                <p>${item.description}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                infrastructure.appendChild(memoryContainer);
            }

            // 将基础设施添加到容器
            container.appendChild(infrastructure);
            
            console.log(`版本 ${selectedVersion} 渲染完成，容器内容:`, container.innerHTML);
        }

                // 渲染对比模式
        function renderCompareMode(selectedVersions) {
            const container = document.getElementById('flow-container');
            container.innerHTML = '';
            container.className = 'flow-container compare-mode';

            selectedVersions.forEach(versionKey => {
                let versionData;
                switch(versionKey) {
                    case 'flowData':
                        versionData = flowData;
                        break;
                    case 'flowData1':
                        versionData = flowData1;
                        break;
                    case 'flowData2':
                        versionData = flowData2;
                        break;
                    default:
                        console.warn(`版本 ${versionKey} 不存在`);
                        return;
                }
                
                if (!versionData) {
                    console.warn(`版本 ${versionKey} 数据无效`);
                    return;
                }

                const versionContainer = document.createElement('div');
                versionContainer.className = `compare-version ${versionKey}`;
                
                const versionTitle = document.createElement('div');
                versionTitle.className = 'compare-version-title';
                versionTitle.textContent = getVersionDisplayName(versionKey);
                versionContainer.appendChild(versionTitle);

                // 创建主流水线容器
                const mainPipeline = document.createElement('div');
                mainPipeline.className = 'compare-row';

                // 创建水平流水线布局
                const domains = ['sensor', 'raw', 'rgb', 'yuv', 'output'];
                
                domains.forEach((domainKey, index) => {
                    const domain = versionData[domainKey];
                    if (!domain || !domain.items || domain.items.length === 0) {
                        console.warn(`版本 ${versionKey} 的域 ${domainKey} 不存在或为空`);
                        return;
                    }
                    
                    // 创建域容器
                    const domainContainer = document.createElement('div');
                    domainContainer.className = 'flow-subgraph';
                    domainContainer.style.minWidth = '150px';
                    
                    // 域标题
                    domainContainer.innerHTML = `
                        <div class="flow-subgraph-title">${domain.title}</div>
                        <div class="flow-row">
                            ${domain.items.map(item => `
                                <div class="flow-step ${item.type}" data-id="${item.id}" data-title="${item.title}" data-description="${item.description}">
                                    <h3>${item.title}</h3>
                                    <p>${item.description}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    mainPipeline.appendChild(domainContainer);
                    
                    // 在域之间添加箭头（除了最后一个域）
                    if (index < domains.length - 1) {
                        const arrow = document.createElement('div');
                        arrow.className = 'flow-arrow';
                        arrow.style.margin = '0 10px';
                        mainPipeline.appendChild(arrow);
                    }
                });

                // 创建基础设施列
                const infrastructure = document.createElement('div');
                infrastructure.className = 'flow-infrastructure';
                infrastructure.style.minWidth = '150px';
                
                // 基础设施标题
                const infrastructureTitle = document.createElement('div');
                infrastructureTitle.className = 'infrastructure-title';
                infrastructureTitle.textContent = '🏗️ 基础设施';
                infrastructure.appendChild(infrastructureTitle);

                // 内存子系统
                if (versionData.memory && versionData.memory.items && versionData.memory.items.length > 0) {
                    const memoryContainer = document.createElement('div');
                    memoryContainer.className = 'flow-subgraph';
                    memoryContainer.style.minWidth = '120px';
                    memoryContainer.style.border = '2px dashed #ffc107';
                    memoryContainer.style.background = 'rgba(255, 193, 7, 0.1)';
                    
                    memoryContainer.innerHTML = `
                        <div class="flow-subgraph-title">${versionData.memory.title}</div>
                        <div class="flow-row">
                            ${versionData.memory.items.map(item => `
                                <div class="flow-step ${item.type}" data-id="${item.id}" data-title="${item.title}" data-description="${item.description}">
                                    <h3>${item.title}</h3>
                                    <p>${item.description}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    infrastructure.appendChild(memoryContainer);
                }
                
                versionContainer.appendChild(mainPipeline);
                versionContainer.appendChild(infrastructure);
                container.appendChild(versionContainer);
            });
        }

        // 获取版本显示名称
        function getVersionDisplayName(versionKey) {
            const names = {
                'flowData': '标准版本',
                'flowData1': '版本1',
                'flowData2': '版本2'
            };
            return names[versionKey] || versionKey;
        }

        // 添加交互效果
        function addInteractivity() {
            const knowledgeItems = document.querySelectorAll('.knowledge-item');
            
            knowledgeItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    // 添加点击动画
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'translateY(-5px)';
                    }, 150);
                    
                    // 显示知识点详情
                    const title = this.dataset.title;
                    const description = this.dataset.description;
                    const status = this.classList.contains('completed') ? 'completed' : 
                                this.classList.contains('pending') ? 'pending' : 'future';
                    
                    console.log(`知识点: ${title}\n描述: ${description}\n状态: ${status}`);
                    
                    // 显示知识点详情（可以扩展为弹窗）
                    showKnowledgeDetail(title, description, status);
                });
            });

            // 为ISP架构图模块添加点击事件
            const flowSteps = document.querySelectorAll('.flow-step');
            flowSteps.forEach(step => {
                step.addEventListener('click', function(e) {
                    // 添加点击动画
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'translateY(-3px)';
                    }, 150);
                    
                    // 显示硬件模块详情
                    const id = this.dataset.id;
                    const title = this.dataset.title;
                    const description = this.dataset.description;
                    const type = this.classList.contains('sensor') ? 'sensor' :
                            this.classList.contains('raw') ? 'raw' :
                            this.classList.contains('rgb') ? 'rgb' :
                            this.classList.contains('yuv') ? 'yuv' :
                            this.classList.contains('output') ? 'output' : 'memory';
                    
                    console.log(`硬件模块: ${title}\n描述: ${description}\n类型: ${type}\nID: ${id}`);
                    
                    // 显示硬件模块详情弹窗
                    showHardwareModuleDetail(id, title, description, type);
                });
            });
        }

        // 显示知识点详情（可以扩展为弹窗）
        function showKnowledgeDetail(title, description, status) {
            let statusText = '';
            if (status === 'completed') {
                statusText = '知识点已完善';
            } else if (status === 'pending') {
                statusText = '知识点待补充';
            } else if (status === 'future') {
                statusText = '知识点待建设';
            }
            
            console.log(`=== ${title} 详细信息 ===`);
            console.log(description);
            console.log(`状态: ${statusText}`);
            console.log('可以在这里添加更多详细信息...');
        }

        // 显示硬件模块详情弹窗
        function showHardwareModuleDetail(id, title, description, type) {
            // 获取模块详细信息
            const moduleDetail = moduleDetails[id];
            if (!moduleDetail) {
                console.warn(`模块 ${id} 的详细信息未找到`);
                return;
            }
            
            // 更新弹窗标题
            document.getElementById('modal-title').textContent = moduleDetail.title;
            
            // 更新弹窗内容
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="module-modal-section">
                    <div class="module-modal-section-title">📋 模块简介</div>
                    <div class="module-modal-section-content">${moduleDetail.introduction}</div>
                </div>
                <div class="module-modal-section">
                    <div class="module-modal-section-title">🔬 实现原理</div>
                    <div class="module-modal-section-content">${moduleDetail.principle}</div>
                </div>
                <div class="module-modal-section">
                    <div class="module-modal-section-title">⚡ 硬件约束</div>
                    <div class="module-modal-section-content">${moduleDetail.constraints}</div>
                </div>
            `;
            
            // 更新"查看更多"链接
            const moreLink = document.getElementById('modal-more-link');
            moreLink.href = moduleDetail.link;
            
            // 显示弹窗
            const modal = document.getElementById('module-modal');
            modal.classList.add('show');
        }

        // 添加滚动动画效果
        function addScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // 观察所有知识区块
            const sections = document.querySelectorAll('.knowledge-section, .flow-diagram');
            sections.forEach(section => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(30px)';
                section.style.transition = 'all 0.6s ease';
                observer.observe(section);
            });
        }

        // 添加键盘导航支持
        function addKeyboardNavigation() {
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    const focusedElement = document.activeElement;
                    if (focusedElement.classList.contains('knowledge-item')) {
                        focusedElement.style.outline = '3px solid #4ecdc4';
                        focusedElement.style.outlineOffset = '2px';
                    }
                }
            });
        }

        // 添加触摸设备支持
        function addTouchSupport() {
            if ('ontouchstart' in window) {
                const knowledgeItems = document.querySelectorAll('.knowledge-item');
                knowledgeItems.forEach(item => {
                    item.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.95)';
                    });
                    
                    item.addEventListener('touchend', function() {
                        this.style.transform = 'translateY(-5px)';
                    });
                });
            }
        }

        // 添加搜索功能
        function addSearchFunctionality() {
            // 创建搜索元素
            const header = document.querySelector('.header');
            const headerContent = document.createElement('div');
            headerContent.className = 'header-content';
            
            // 保存原有的标题内容
            const originalContent = header.innerHTML;
            header.innerHTML = '';
            
            headerContent.innerHTML = `
                <div class="header-title">
                    <h1>ISP图像处理知识库</h1>
                    <p>Image Signal Processor 图像信号处理器完整知识体系</p>
                </div>
                <div class="search-container">
                    <div class="search-icon">🔍</div>
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="搜索知识点...">
                        <button class="search-button">搜索</button>
                    </div>
                </div>
            `;
            
            header.appendChild(headerContent);
            
            // 获取元素
            const searchIcon = document.querySelector('.search-icon');
            const searchBox = document.querySelector('.search-box');
            const searchInput = document.querySelector('.search-input');
            const headerTitle = document.querySelector('.header-title');
            
            // 点击搜索图标事件
            searchIcon.addEventListener('click', function() {
                // 切换搜索框展开状态
                searchBox.classList.toggle('expanded');
                
                // 切换标题位置
                headerTitle.classList.toggle('shifted');
                
                // 如果展开，自动聚焦到输入框
                if (searchBox.classList.contains('expanded')) {
                    setTimeout(() => {
                        searchInput.focus();
                    }, 400);
                }
            });
            
            // 搜索按钮事件
            const searchButton = document.querySelector('.search-button');
            searchButton.addEventListener('click', function() {
                performSearch(searchInput.value);
            });
            
            // 回车键搜索
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch(searchInput.value);
                }
            });
            
            // 点击外部关闭搜索框
            document.addEventListener('click', function(e) {
                if (!header.contains(e.target) && searchBox.classList.contains('expanded')) {
                    searchBox.classList.remove('expanded');
                    headerTitle.classList.remove('shifted');
                }
            });
        }

        // 执行搜索功能
        function performSearch(query) {
            if (!query.trim()) return;
            
            console.log('搜索关键词:', query);
            
            // 这里可以实现实际的搜索逻辑
            // 例如：搜索知识点、硬件模块等
            alert(`搜索功能已触发，关键词: ${query}\n(实际项目中会在这里实现搜索逻辑)`);
            
            // 可以添加的搜索逻辑示例:
            /*
            // 搜索知识点
            const knowledgeItems = document.querySelectorAll('.knowledge-item');
            knowledgeItems.forEach(item => {
                const title = item.querySelector('h3').textContent;
                const description = item.querySelector('p').textContent;
                
                if (title.includes(query) || description.includes(query)) {
                    // 高亮匹配的项目
                    item.style.boxShadow = '0 0 0 3px #4ecdc4';
                    // 滚动到该项目
                    item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
            */
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面开始初始化...');
            
            // 检查数据是否存在
            console.log('flowData:', window.flowData);
            console.log('flowData1:', window.flowData1);
            console.log('flowData2:', window.flowData2);
            
            // 渲染所有内容
            renderKnowledgeSections();
            console.log('知识点区块渲染完成');
            renderFlowDiagram();
            console.log('ISP架构图渲染完成');
            
            // 添加交互功能
            addInteractivity();
            addScrollAnimations();
            addKeyboardNavigation();
            addTouchSupport();
            
            // 添加版本切换和对比功能
            addVersionControls();
            
            // 添加弹窗控制功能
            addModalControls();

            // 添加悬停弹窗和抽屉菜单功能
            addHoverPopupAndDrawer();

            // 添加搜索功能
            addSearchFunctionality();
            
            console.log('页面初始化完成');
        });

        // 添加版本控制功能
        function addVersionControls() {
            const versionSelect = document.getElementById('version-select');
            const compareBtn = document.getElementById('compare-btn');
            const comparePanel = document.getElementById('compare-panel');
            const startCompareBtn = document.getElementById('start-compare');
            const cancelCompareBtn = document.getElementById('cancel-compare');
            const compareCheckboxes = document.querySelectorAll('.compare-options input[type="checkbox"]');

            // 版本切换事件
            versionSelect.addEventListener('change', function() {
                const selectedVersion = this.value;
                renderFlowDiagram(selectedVersion);
                addInteractivity();
            });

            // 对比按钮点击事件
            compareBtn.addEventListener('click', function() {
                comparePanel.style.display = comparePanel.style.display === 'none' ? 'block' : 'none';
            });

            // 开始对比事件
            startCompareBtn.addEventListener('click', function() {
                const selectedVersions = [];
                compareCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedVersions.push(checkbox.value);
                    }
                });

                if (selectedVersions.length < 2) {
                    alert('请至少选择两个版本进行对比！');
                    return;
                }

                if (selectedVersions.length > 3) {
                    alert('最多只能对比三个版本！');
                    return;
                }

                renderCompareMode(selectedVersions);
                addInteractivity();
                comparePanel.style.display = 'none';
                
                // 重置复选框
                compareCheckboxes.forEach(checkbox => checkbox.checked = false);
            });

            // 取消对比事件
            cancelCompareBtn.addEventListener('click', function() {
                comparePanel.style.display = 'none';
                // 重置复选框
                compareCheckboxes.forEach(checkbox => checkbox.checked = false);
            });

            // 点击外部关闭对比面板
            document.addEventListener('click', function(event) {
                if (!compareBtn.contains(event.target) && !comparePanel.contains(event.target)) {
                    comparePanel.style.display = 'none';
                }
            });
        }

        // 添加弹窗控制功能
        function addModalControls() {
            const modal = document.getElementById('module-modal');
            const closeBtn = document.getElementById('modal-close');
            
            // 关闭按钮点击事件
            closeBtn.addEventListener('click', function() {
                modal.classList.remove('show');
            });
            
            // 点击弹窗外部关闭弹窗
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });
            
            // ESC键关闭弹窗
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && modal.classList.contains('show')) {
                    modal.classList.remove('show');
                }
            });
        }

        // 提供全局函数，方便外部调用和修改数据
        window.ISPKnowledgeBase = {
            // 添加新的知识点
            addKnowledgeItem: function(sectionKey, item) {
                if (knowledgeData[sectionKey]) {
                    knowledgeData[sectionKey].items.push(item);
                    renderKnowledgeSections();
                    addInteractivity();
                }
            },
            
            // 删除知识点
            removeKnowledgeItem: function(sectionKey, itemTitle) {
                if (knowledgeData[sectionKey]) {
                    knowledgeData[sectionKey].items = knowledgeData[sectionKey].items.filter(
                        item => item.title !== itemTitle
                    );
                    renderKnowledgeSections();
                    addInteractivity();
                }
            },
            
            // 修改知识点
            updateKnowledgeItem: function(sectionKey, itemTitle, newData) {
                if (knowledgeData[sectionKey]) {
                    const item = knowledgeData[sectionKey].items.find(item => item.title === itemTitle);
                    if (item) {
                        Object.assign(item, newData);
                        renderKnowledgeSections();
                        addInteractivity();
                    }
                }
            },
            
            // 获取所有数据
            getData: function() {
                return {
                    knowledge: knowledgeData,
                    flow: flowData
                };
            },
            
            // 重新渲染界面
            refresh: function() {
                renderKnowledgeSections();
                renderFlowDiagram();
                addInteractivity();
                addScrollAnimations();
            },
            
            // 切换版本
            switchVersion: function(versionKey) {
                const versionSelect = document.getElementById('version-select');
                if (versionSelect) {
                    versionSelect.value = versionKey;
                    renderFlowDiagram(versionKey);
                    addInteractivity();
                }
            },
            
            // 进入对比模式
            enterCompareMode: function(selectedVersions) {
                if (selectedVersions && selectedVersions.length >= 2 && selectedVersions.length <= 3) {
                    renderCompareMode(selectedVersions);
                    addInteractivity();
                }
            },
            
            // 退出对比模式，返回单版本显示
            exitCompareMode: function(versionKey = 'flowData') {
                const container = document.getElementById('flow-container');
                container.className = 'flow-container';
                renderFlowDiagram(versionKey);
                addInteractivity();
            }
        };
    </script>
</body>
</html>
